package com.glabs.homegenie;

import java.util.ArrayList;
import java.util.List;

import com.glabs.homegenie.adapters.ModulesAdapter;
import com.glabs.homegenie.service.Control;
import com.glabs.homegenie.service.Control.GetGroupModulesCallback;
import com.glabs.homegenie.service.Control.GetGroupsCallback;
import com.glabs.homegenie.service.data.Group;
import com.glabs.homegenie.service.data.Module;
import com.glabs.homegenie.util.SystemUiHider;
import com.viewpagerindicator.PageIndicator;
import com.viewpagerindicator.TitlePageIndicator;

import android.annotation.TargetApi;
import android.app.Activity;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.support.v4.app.FragmentActivity;
import android.support.v4.view.ViewPager;
import android.support.v4.view.ViewPager.OnPageChangeListener;
import android.view.MotionEvent;
import android.view.View;
import android.widget.ListView;

/**
 * An example full-screen activity that shows and hides the system UI (i.e.
 * status bar and navigation/system bar) with user interaction.
 *
 * @see SystemUiHider
 */
public class StartActivity extends FragmentActivity {
   
    

    ViewPager mPager;
    PageIndicator mIndicator;
    TestFragmentAdapter mAdapter;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        setContentView(R.layout.activity_start);
        //setContentView(R.layout.simple_titles);

        mAdapter = new TestFragmentAdapter(getSupportFragmentManager());

        mPager = (ViewPager)findViewById(R.id.pager);
        mPager.setAdapter(mAdapter);

        mIndicator = (TitlePageIndicator)findViewById(R.id.indicator);
        mIndicator.setViewPager(mPager);
        mIndicator.setOnPageChangeListener( new OnPageChangeListener() {
			
			@Override
			public void onPageSelected(final int pindex) {
		        
		        Control.getGroupModules(mAdapter.getGroup(pindex).Name, new GetGroupModulesCallback() {
					@Override
					public void groupModulesUpdated(final ArrayList<Module> modules) {
						runOnUiThread(new Runnable() {
							
							@Override
							public void run() {
								View v = (View)mPager.getChildAt(pindex - 1);
								if (v != null)
								{
									ListView lv = (ListView)v.findViewById(R.id.listView);
									lv.setAdapter(new ModulesAdapter(getApplicationContext(), R.layout.widget_generic, modules));
								}
							}
							
						});
					}
				});				

			}
			
			@Override
			public void onPageScrolled(int arg0, float arg1, int arg2) {
				// TODO Auto-generated method stub
				
			}
			
			@Override
			public void onPageScrollStateChanged(int arg0) {
				// TODO Auto-generated method stub
				
			}
		});

    }

    @Override
    protected void onPostCreate(Bundle savedInstanceState) {
        super.onPostCreate(savedInstanceState);

        Control.setHgServer("192.168.0.2", "admin", "hgrocks");
        
        Control.getGroups(new GetGroupsCallback() {
			
			@Override
			public void groupsUpdated(ArrayList<Group> groups) {
				mAdapter.setGroups(groups);
			}
		});
        
    }


}
